---
title: "Slope Chart in R"
output:
  html_document:
    df_print: paged
  html_notebook: default
  pdf_document: default
---

## The Slope Chart
By now we discussed the slope chart multiple times in lecutres. 
This includes

* appropriate times to use the chart,
* multiple ways to make the chart,
* fine tuning aspects of the chart. 

So there is really not a reason to repeat those aspects of explanation here.
You also saw two different approaches to crafting the chart in Microsoft Excel. 
Recall the basics of those two approaches are the same, one gave us an easier time to create labels if that was the way we wanted to go. 
We are going to have one twist here and it comes with the data and is a really important distinction you need to know if you plan to use data in your career. 

## Data Discussions
We use the same types of commands as we did last time to load the libraries and the data for us. 

```{r Package set up and data location}
library(tidyverse)
urlfile="https://raw.githubusercontent.com/flynnecon/datavizf25/refs/heads/main/data/birth_rates_370f25.csv"
brdata_wide <- read_csv(url(urlfile))
View(brdata_wide)
```

The title may seem odd to you but I did this because this data is in a format called *wide*.
Think of it like this, every variable is in a column of its own.
This is one way to store data and it is perfectly fine and works for the mindset of most people.
However, there are alternative ways to organize data and we are going to explore one of them here, called *long* data. 
This works when variables themselves might simply be a value we can use in identification. 
Think, for example, of **male** versus **female** test scores. 
We could have a variable for each, and there are situations where that makes sense, or we could use the sex identifier as a value in another variable, in this case *sex*. 

Now we want to change the data into the format *long".

```{r changing data wide to long}
brdata_long <- brdata_wide |> pivot_longer(cols=c("y2000","y2024"),names_to="year")
View(brdata_long)
```
So now you see how the data are set up differently. 
This makes the visualization efforts easier in many cases.
Why?
In some very real ways the data organized highlight the importance of different pieces and what is truly a distinctive characteristic.

## Grouped Bar Chart
So let's create the first chart type we did in Excel, the grouped bar chart. 
We will group by *country*, distinguish by *year*, and the value is the birth rate in the *value* column.

So some elements to consider, I think the **x-axis** and **y-axis** are pretty clear but there are different pieces too:

* **fill** is what the color is going to be and we want it split out by *year* as we saw in Excel and this goes in the aesthetics portion, and
* **position** is used if we want to have the columns next to each other so we use *dodge* and this goes in the **geom_bar** section(without this it would be stacked which we deal with later)
* **stat** is again telling R what to do with the data but it is already the value we need so we use *identity* and this also goes in the **geom_bar** section.

```{r bar chart}
brdata_long |> ggplot(aes(x=country,y=value,fill=year)) + geom_bar(position="dodge",stat="identity")
```

So that is what we had before in terms of bar chart outcomes. Now we want to make the slope chart. 

## Slope Chart

Recall the key part of the slope chart is to reorganize the dat so that we have lines connecting each of the points for the groups of interest.
In this case we group on country and have two observations in the *year* variable.

```{r Basic slope chart}
brdata_long |> ggplot(aes(x=year,y=value,group=country,color=factor(country))) + geom_line()
```

The new important elements here:

* Identify the **group** as *country* in order for R to make a line for each country, 
* **color** is needed to distinguish the groups but it is not readable as is so we use **factor** as a command that tells R to identify the values in *country* as **factors** for the color. 

Congratulations this gives us the basics of the *Slope Chart*.
However, we can make this a bit nicer. 
I want to make the lines a bit thicker, a bit transparent and I want to add points at the end of the line segment like we did in the Excel plot. 

Inside the *geom_line* I want to add **linewidth=2** and **alpha=0.5**. 
These control the size of the line and the transparency. 
You can play around with these values to see what these look like. 

Next we want to add dots at the end of the line segments. 
This is very much like the **scatterplot** addition from the last Excel chart creation. 
For this we add *geom_point(size=3)* to the end of the command. 
So modified the command now looks like:

```{r Snazzier slope chart}
brdata_long |> ggplot(aes(x=year,y=value,group=country,color=factor(country))) + geom_line(linewidth=2, alpha=0.5) + geom_point(size=3)
```

Some further options to consider are the labels for the axes.
You can also consider if we want to add lables to the data points like we did in Excel and clear our the grid lines and other pieces. 
The code at that point can be very intense, but it can be worth it for a replicable chart. 




